$uiLoginForm = ($onLoginAttempt) fun {
	$nameField = $nameInput uiTextfieldVariableOnchange {}.
	$passwordInput = "". $passwordInputRef = reference: $passwordInput.
	$passwordField = {passwordInputRef = x} uiPasswordOnchange passwordInput.
	
	$views =
		[uiText: "Name"];
		[@(percentWidth: 100) nameField];
		[uiText: "Password"];
		[@(percentWidth: 100) passwordField];
		[@center {
			$response = nameInput serviceLoginUser passwordInput.
			!if ("0" eq first: response) {
				$calcitSession storageSaveString second: response.
				$calcitUserName storageSaveString nameInput.
				popupMessage: "Success! Your are now logged in".
				onLoginAttempt: true.
			}. else {
				popupMessage: second: response.
				onLoginAttempt: false.
			}.
		} uiButton "Login"];
		[@(emHeight 2) uiContainer: void];
		[@centerText uiText: "-- or you could --"];
		[@center {openSubApp: "register"} uiButton "Register a new user"].
		
	uiContainer: views
}.

$uiRegisterForm = () fun {
	$nameField = $nameInput uiTextfieldVariableOnchange {}.
	$passwordInput = "". $passwordInputRef = reference: $passwordInput.
	$passwordField = {passwordInputRef = x} uiPasswordOnchange passwordInput.
	
	$views =
		[uiText: "Name"];
		[@(percentWidth: 100) nameField];
		[uiText: "Password"];
		[@(percentWidth: 100) passwordField];
		[@center {
        	$response = nameInput serviceRegisterUser passwordInput.
        	!if ("0" eq first: response) {
        		popupMessage: "Success! Your user was created. You can now log in.".
        	}. else {
        		popupMessage: second: response
        	}.
        } uiButton "Register"].
		
	uiContainer: views
}
