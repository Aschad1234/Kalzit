(function(){function loadImageAndThen(imageUrl,andThen){var image=document.createElement("img");image.onload=function(){var width=image.width;var height=image.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;canvas.getContext("2d").drawImage(image,0,0,image.width,image.height);var pixels=canvas.getContext("2d").getImageData(0,0,width,height).data;andThen(pixels,width,height)};image.src="server/serverside_load.php?query="+encodeURIComponent(imageUrl)}GLang.defaultRuntimeEnvironment.setInnerVariable("loadImageAsync",{value:function(env,args){loadImageAndThen(args[1].value,function(pixels,width,height){var result=[];for(var x=0;x<width;x++){result.push({value:[]});for(var y=0;y<height;y++){var start=(y*width+x)*4;result[x].value.push({value:[{value:pixels[start]},{value:pixels[start+1]},{value:pixels[start+2]},{value:pixels[start+3]}]})}}GLang.callObject(args[0],env,[{value:result}])});return{value:0,display:"none"}},display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("loadImageAsyncRgb",{value:function(env,args){loadImageAndThen(args[1].value,function(pixels,width,height){var result=[];for(var x=0;x<width;x++){result.push({value:[]});for(var y=0;y<height;y++){var start=(y*width+x)*4;result[x].value.push({value:[{value:pixels[start]},{value:pixels[start+1]},{value:pixels[start+2]}]})}}GLang.callObject(args[0],env,[{value:result}])});return{value:0,display:"none"}},display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("loadImageAsyncMono",{value:function(env,args){loadImageAndThen(args[1].value,function(pixels,width,height){var result=[];for(var x=0;x<width;x++){result.push({value:[]});for(var y=0;y<height;y++){var start=(y*width+x)*4;result[x].value.push({value:(pixels[start]+pixels[start+1]+pixels[start+2])/3})}}GLang.callObject(args[0],env,[{value:result}])});return{value:0,display:"none"}},display:"function"})})();(function(thiz){function getVoiceObject(voiceName){for(var i=0;i<speechSynthesis.getVoices().length;i++){if(speechSynthesis.getVoices()[i].name===voiceName){return speechSynthesis.getVoices()[i]}}}thiz.speechSay=function(text,voice){var ssu=new SpeechSynthesisUtterance(text);ssu.voice=getVoiceObject(voice)||ssu.voice;speechSynthesis.speak(ssu);return text};thiz.speechGetVoicesByLanguage=function(language){var list=[];for(var i=0;i<speechSynthesis.getVoices().length;i++){if(speechSynthesis.getVoices()[i].lang.startsWith(language)){list.push(speechSynthesis.getVoices()[i].name)}}return list};thiz.speechGetVoices=function(){var list=[];for(var i=0;i<speechSynthesis.getVoices().length;i++){list.push(speechSynthesis.getVoices()[i].name)}return list}})(this);(function(){var queue=[];var apiLoaded=false;var apiBooted=false;function runWithTwitchApi(fun){try{if(apiLoaded){fun()}else{queue.push(fun);if(!apiBooted){var scriptTag=document.createElement("script");scriptTag.src="https://player.twitch.tv/js/embed/v1.js";scriptTag.onload=function(){apiLoaded=true;while(queue.length)queue.pop()()};document.head.appendChild(scriptTag);apiBooted=true}}}catch(e){console.error("Dang, this might be why the twitch player does not work:");console.error(e)}}function uiTwitchChannelPlayer(channel,playerCallback){var player=document.createElement("div");runWithTwitchApi(function(){playerCallback(new Twitch.Player(player,{channel:channel,width:"100%",height:"100%"}))});return{display:"dom",value:player}}function uiTwitchVideoPlayer(video,playerCallback){var player=document.createElement("div");runWithTwitchApi(function(){playerCallback(new Twitch.Player(player,{video:video,width:"100%",height:"100%"}))});return{display:"dom",value:player}}function uiTwitchCollectionPlayer(collection,playerCallback){var player=document.createElement("div");runWithTwitchApi(function(){playerCallback(new Twitch.Player(player,{collection:collection,width:"100%",height:"100%"}))});return{display:"dom",value:player}}function playerValue(player){var onEnd=function(){};player.addEventListener(Twitch.Player.ENDED,function(state){onEnd()});var onProgress=function(time){};var lastTime=null;setInterval(function(){var newTime=player.getCurrentTime();if(lastTime!==newTime){onProgress(lastTime=newTime)}},100);var controller={value:[{value:[{value:"play"},{value:function(env,args){player.play();return GLang.voidValue},display:"function"}]},{value:[{value:"pause"},{value:function(env,args){player.pause();return GLang.voidValue},display:"function"}]},{value:[{value:"getDuration"},{value:function(env,args){return{value:player.getDuration()}},display:"function"}]},{value:[{value:"setTime"},{value:function(env,args){player.seek(parseInt(args[0].value+""));return GLang.voidValue},display:"function"}]},{value:[{value:"setVolume"},{value:function(env,args){player.setVolume(parseFloat(args[0].value+""));return GLang.voidValue},display:"function"}]},{value:[{value:"getVolume"},{value:function(env,args){return{value:player.getVolume()}},display:"function"}]},{value:[{value:"setOnEnd"},{value:function(env,args){onEnd=function(){GLang.callObject(args[0],env,[controller])};return GLang.voidValue},display:"function"}]},{value:[{value:"getProgress"},{value:function(env,args){return{value:player.getCurrentTime()}},display:"function"}]},{value:[{value:"setOnProgress"},{value:function(env,args){onProgress=function(time){GLang.callObject(args[0],env,[{value:time},controller])};return GLang.voidValue},display:"function"}]}]};return controller}GLang.defaultRuntimeEnvironment.setInnerVariable("uiTwitchChannelPlayer",{value:function(env,args){return uiTwitchChannelPlayer(args[0].value,function(player){GLang.callObject(args.length>=2?args[1]:{value:""},env,[playerValue(player)])})}});GLang.defaultRuntimeEnvironment.setInnerVariable("uiTwitchVideoPlayer",{value:function(env,args){return uiTwitchVideoPlayer(args[0].value,function(player){GLang.callObject(args.length>=2?args[1]:{value:""},env,[playerValue(player)])})}});GLang.defaultRuntimeEnvironment.setInnerVariable("uiTwitchCollectionPlayer",{value:function(env,args){return uiTwitchCollectionPlayer(args[0].value,function(player){GLang.callObject(args.length>=2?args[1]:{value:""},env,[playerValue(player)])})}})})();(function(global){function makePlayerInterface(mediaElement){var onEnd=function(){};var onProgress=function(time){};mediaElement.addEventListener("ended",function myHandler(e){onEnd()},false);mediaElement.addEventListener("timeupdate",function myHandler(e){onProgress(mediaElement.currentTime)},false);var controller={value:[{value:[{value:"play"},{value:function(env,args){mediaElement.play();return GLang.voidValue},display:"function"}]},{value:[{value:"pause"},{value:function(env,args){mediaElement.pause();return GLang.voidValue},display:"function"}]},{value:[{value:"setVolume"},{value:function(env,args){mediaElement.volume=parseFloat(args[0].value+"");return GLang.voidValue},display:"function"}]},{value:[{value:"getVolume"},{value:function(env,args){return{value:mediaElement.volume}},display:"function"}]},{value:[{value:"getDuration"},{value:function(env,args){return{value:mediaElement.duration}},display:"function"}]},{value:[{value:"setTime"},{value:function(env,args){mediaElement.currentTime=parseFloat(args[0].value+"");return GLang.voidValue},display:"function"}]},{value:[{value:"setOnEnd"},{value:function(env,args){onEnd=function(){GLang.callObject(args[0],env,[controller])};return GLang.voidValue},display:"function"}]},{value:[{value:"getProgress"},{value:function(env,args){return{value:mediaElement.currentTime}},display:"function"}]},{value:[{value:"setOnProgress"},{value:function(env,args){onProgress=function(time){GLang.callObject(args[0],env,[{value:time},controller])};return GLang.voidValue},display:"function"}]}]};return controller}GLang.defaultRuntimeEnvironment.setInnerVariable("uiAudioPlayer",{value:function(env,args){var audio=document.createElement("audio");audio.classList.add("calcitAudioPlayer");audio.src=args[0].value;audio.controls="controls";GLang.callObject(args.length>=2?args[1]:GLang.stringValue(""),env,[makePlayerInterface(audio)]);return{value:audio,display:"dom"}},display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("uiVideoPlayer",{value:function(env,args){var video=document.createElement("video");video.classList.add("calcitAudioPlayer");video.src=args[0].value;video.controls="controls";GLang.callObject(args.length>=2?args[1]:GLang.stringValue(""),env,[makePlayerInterface(video)]);return{value:video,display:"dom"}},display:"function"})})(this);GLang.defaultRuntimeEnvironment.setInnerVariable("uiShowImageDataChannelsRgb",{value:function(env,args){var canvas=document.createElement("canvas");var channels=args[1].value;var redChannel=channels[0].value;var greenChannel=channels[1].value;var blueChannel=channels[2].value;var width,height;if(redChannel instanceof Array){width=redChannel.length;height=redChannel[0].value.length}else if(greenChannel instanceof Array){width=greenChannel.length;height=greenChannel[0].value.length}else if(blueChannel instanceof Array){width=blueChannel.length;height=blueChannel[0].value.length}var imageData=canvas.getContext("2d").createImageData(width,height);for(var y=0;y<imageData.height;y++){for(var x=0;x<imageData.width;x++){for(var i=0;i<4;i++){var index=(imageData.width*y+x)*4+i;switch(i){case 0:imageData.data[index]=GLang.at(y,GLang.at(x,redChannel)).value;break;case 1:imageData.data[index]=GLang.at(y,GLang.at(x,greenChannel)).value;break;case 2:imageData.data[index]=GLang.at(y,GLang.at(x,blueChannel)).value;break;case 3:imageData.data[index]=GLang.callObject(args[0],env,[{value:[imageData.data[index-3],imageData.data[index-2],imageData.data[index-1]]}]).value}}}}canvas.width=imageData.width;canvas.height=imageData.height;canvas.getContext("2d").putImageData(imageData,0,0);return{value:canvas,display:"dom"}},display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("uiShowImageDataChannels",{value:function(env,args){var canvas=document.createElement("canvas");var channels=args[0].value;var redChannel=channels[0].value;var greenChannel=channels[1].value;var blueChannel=channels[2].value;var alphaChannel=channels[3].value;var width,height;if(redChannel instanceof Array){width=redChannel.length;height=redChannel[0].value.length}else if(greenChannel instanceof Array){width=greenChannel.length;height=greenChannel[0].value.length}else if(blueChannel instanceof Array){width=blueChannel.length;height=blueChannel[0].value.length}else if(alphaChannel instanceof Array){width=alphaChannel.length;height=alphaChannel[0].value.length}var imageData=canvas.getContext("2d").createImageData(width,height);for(var y=0;y<imageData.height;y++){for(var x=0;x<imageData.width;x++){for(var i=0;i<4;i++){var index=(imageData.width*y+x)*4+i;switch(i){case 0:imageData.data[index]=GLang.at(y,GLang.at(x,redChannel)).value;break;case 1:imageData.data[index]=GLang.at(y,GLang.at(x,greenChannel)).value;break;case 2:imageData.data[index]=GLang.at(y,GLang.at(x,blueChannel)).value;break;case 3:imageData.data[index]=GLang.at(y,GLang.at(x,alphaChannel)).value;break}}}}canvas.width=imageData.width;canvas.height=imageData.height;canvas.getContext("2d").putImageData(imageData,0,0);return{value:canvas,display:"dom"}},display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("uiShowSvgPath",{value:GLang.arrayFun(function(env,args){var dimsAndPath=args[0].value.split("\n");var dims=dimsAndPath[0];var path=dimsAndPath[1];var svgTag=document.createElement("svg");var pathTag=document.createElement("path");pathTag.setAttribute("d",path);if(dims){pathTag.setAttribute("viewBox",dims)}svgTag.appendChild(pathTag);return{value:svgTag,display:"dom"}}),display:"function"});GLang.defaultRuntimeEnvironment.setInnerVariable("uiShowWebpageUrl",{value:GLang.arrayFun(function(env,args){var iframe=document.createElement("iframe");iframe.src=args[0].value;return{value:iframe,display:"dom"}})});(function(){var queue=[];var apiLoaded=false;var apiBooted=true;function runWithVimeoApi(fun){try{if(apiLoaded){fun()}else{queue.push(fun);if(!apiBooted){var scriptTag=document.createElement("script");scriptTag.src="https://player.vimeo.com/api/player.js";scriptTag.onload=function(){apiLoaded=true;while(queue.length)queue.pop()()};document.head.appendChild(scriptTag);apiBooted=true}}}catch(e){console.error(e)}}function uiVimeoPlayer(video,playerCallback){var frame=document.createElement("iframe");frame.src="https://player.vimeo.com/video/"+video;frame.setAttribute("frameborder",0);runWithVimeoApi(function(){playerCallback(new Vimeo.Player(frame))});return{display:"dom",value:frame}}function playerValue(player){var onEnd=function(){};player.on("ended",function(data){onEnd()});var onProgress=function(time){};var lastTime=null;setInterval(function(){var newTime=player.getCurrentTime();if(lastTime!==newTime){onProgress(lastTime=newTime)}},100);var controller={value:[{value:[{value:"play"},{value:function(env,args){player.play();return GLang.voidValue},display:"function"}]},{value:[{value:"pause"},{value:function(env,args){player.pause();return GLang.voidValue},display:"function"}]},{value:[{value:"getDuration"},{value:function(env,args){return{value:player.getDuration()}},display:"function"}]},{value:[{value:"setTime"},{value:function(env,args){player.seek(parseInt(args[0].value+""));return GLang.voidValue},display:"function"}]},{value:[{value:"setVolume"},{value:function(env,args){player.setVolume(parseFloat(args[0].value+""));return GLang.voidValue},display:"function"}]},{value:[{value:"getVolume"},{value:function(env,args){return{value:player.getVolume()}},display:"function"}]},{value:[{value:"setOnEnd"},{value:function(env,args){onEnd=function(){GLang.callObject(args[0],env,[controller])};return GLang.voidValue},display:"function"}]},{value:[{value:"getProgress"},{value:function(env,args){return{value:player.getCurrentTime()}},display:"function"}]},{value:[{value:"setOnProgress"},{value:function(env,args){onProgress=function(time){GLang.callObject(args[0],env,[{value:time},controller])};return GLang.voidValue},display:"function"}]}]};return controller}GLang.defaultRuntimeEnvironment.setInnerVariable("uiVimeoPlayer",{value:function(env,args){return uiVimeoPlayer(args[0].value,function(player){GLang.callObject(args.length>=2?args[1]:{value:""},env,[playerValue(player)])})}})})();(function(){var queue=[];var apiLoaded=false;var apiBooted=false;window.onYouTubePlayerAPIReady=function(){apiLoaded=true;while(queue.length){queue.pop()()}};function runWithYtApi(fun){if(apiLoaded){fun()}else{queue.push(fun);if(!apiBooted){var tag=document.createElement("script");tag.src="https://www.youtube.com/player_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);apiBooted=true}}}function uiYoutubePlayer(id,playerCallback){var player=document.createElement("div");runWithYtApi(function(){playerCallback(new YT.Player(player,{videoId:id}))});return{display:"dom",value:player}}function playerValue(player){var onEnd=function(){};player.addEventListener("onStateChange",function(state){switch(state.data){case YT.PlayerState.ENDED:onEnd();break}});var onProgress=function(time){};var lastTime=null;setInterval(function(){var newTime=player.getCurrentTime();if(lastTime!==newTime){onProgress(lastTime=newTime)}},100);var controller={value:[{value:[{value:"play"},{value:function(env,args){player.playVideo();return GLang.voidValue},display:"function"}]},{value:[{value:"pause"},{value:function(env,args){player.pauseVideo();return GLang.voidValue},display:"function"}]},{value:[{value:"getDuration"},{value:function(env,args){return{value:player.getDuration()}},display:"function"}]},{value:[{value:"setTime"},{value:function(env,args){player.seekTo(parseInt(args[0].value+""));return GLang.voidValue},display:"function"}]},{value:[{value:"setVolume"},{value:function(env,args){player.setVolume(parseFloat(args[0].value+"")*100);return GLang.voidValue},display:"function"}]},{value:[{value:"getVolume"},{value:function(env,args){return{value:player.getVolume()/100}},display:"function"}]},{value:[{value:"setOnEnd"},{value:function(env,args){onEnd=function(){GLang.callObject(args[0],env,[controller])};return GLang.voidValue},display:"function"}]},{value:[{value:"getProgress"},{value:function(env,args){return{value:player.getCurrentTime()}},display:"function"}]},{value:[{value:"setOnProgress"},{value:function(env,args){onProgress=function(time){GLang.callObject(args[0],env,[{value:time},controller])};return GLang.voidValue},display:"function"}]}]};return controller}GLang.defaultRuntimeEnvironment.setInnerVariable("uiNativeYoutubePlayer",{value:function(env,args){return uiYoutubePlayer(args[0].value,function(player){console.log(player);GLang.callObject(args.length>=2?args[1]:{value:""},env,[playerValue(player)])})}})})();